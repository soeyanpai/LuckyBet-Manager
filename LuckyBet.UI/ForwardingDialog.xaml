<Window x:Class="LuckyBet.UI.ForwardingDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LuckyBet.UI"
        mc:Ignorable="d"

        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.FontWeight="Medium"
        TextElement.FontSize="14"
        FontFamily="{materialDesign:MaterialDesignFont}"
        
        Title="အထက်ဒိုင်သို့ စာရင်းလွှဲပြောင်းရန်" Height="600" Width="800"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResizeWithGrip">

    <DockPanel Margin="16">
        <!-- Bottom Action Bar -->
        <DockPanel DockPanel.Dock="Bottom" Margin="0,16,0,0">
            <!-- Summary Text -->
            <TextBlock Text="စုစုပေါင်း လွှဲပြောင်းမည့်ငွေ: 0 ကျပ်" 
                       FontWeight="Bold" VerticalAlignment="Center"/>

            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="ပယ်ဖျက်မည်" Style="{StaticResource MaterialDesignTextButton}" Margin="0,0,8,0" IsCancel="True"/>
                <Button Content="အတည်ပြု လွှဲပြောင်းမည်"
                        Command="{Binding ConfirmForwardCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
            </StackPanel>
        </DockPanel>

        <!-- Top Upline Selection -->
        <ComboBox DockPanel.Dock="Top" 
          materialDesign:HintAssist.Hint="လွှဲပြောင်းမည့် အထက်ဒိုင်"
          Style="{StaticResource MaterialDesignOutlinedComboBox}" 
          Margin="0,0,0,16"
          ItemsSource="{Binding UplineList}"
          DisplayMemberPath="Name"
          SelectedItem="{Binding SelectedUpline}"/>

        <!-- Main DataGrid for Forwarding -->
        <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                  VerticalGridLinesBrush="{DynamicResource MaterialDesignDivider}" 
                  HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}"
                  ItemsSource="{Binding ForwardingItems}">

            <DataGrid.Columns>
                <!-- Column 1: ဂဏန်း -->
                <DataGridTextColumn Header="ဂဏန်း" Binding="{Binding Number}" IsReadOnly="True" FontWeight="Bold" Width="Auto"/>

                <!-- Column 2: စုစုပေါင်း ကျော်လွန်ငွေ -->
                <DataGridTextColumn Header="စုစုပေါင်း ကျော်လွန်ငွေ" Binding="{Binding OriginalOverAmount, StringFormat=N0}" IsReadOnly="True" Width="*"/>
                
                <!-- Column 3: လွှဲမည့် ပမာဏ (Editable - Updated) -->
                <DataGridTemplateColumn Header="လွှဲမည့် ပမာဏ" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding ForwardAmount, StringFormat=N0, UpdateSourceTrigger=LostFocus, TargetNullValue=''}" 
                            TextAlignment="Center" VerticalContentAlignment="Center" BorderThickness="0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Column 4: ကျန်ငွေ -->
                <DataGridTextColumn Header="ကျန်ငွေ" Binding="{Binding UnforwardedAmount, StringFormat=N0}" IsReadOnly="True" Width="*"/>

            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>